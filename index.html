<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Dark Jurassic | Command Terminal V4.0</title>
    <link rel="icon" type="image/png" href="logo.png">
    
    <!-- External Assets -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs (Compat Mode) -->
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <!-- Leaflet Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --primary: #e63946;
            --primary-dim: #8a232b;
            --primary-glow: rgba(230, 57, 70, 0.5);
            --secondary: #00d4ff;
            --secondary-glow: rgba(0, 212, 255, 0.3);
            --bg-dark: #050505;
            --bg-panel: #0a0a0a;
            --bg-card: #0e0e0e;
            --border: rgba(255, 255, 255, 0.1);
            --border-focus: rgba(230, 57, 70, 0.8);
            --accent-blue: #5dade2;
            --text-main: #eeeeee;
            --text-dim: #888888;
            --text-highlight: #ffffff;
            --success: #2ecc71;
            --warning: #f1c40f;
            --danger: #ff0000;
            --sidebar-width: 280px;
            --nav-height: 70px;
            --scanline-color: rgba(0, 0, 0, 0.5);
            --glass: rgba(20, 20, 20, 0.6);
            --terminal-bg: #0c0c0c;
            --radar-bg: rgba(0, 20, 0, 0.9);
        }

        /* --- GLOBAL RESET & SCROLLBAR --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        ::-webkit-scrollbar { width: 5px; height: 5px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'JetBrains+Mono', monospace;
            overflow-x: hidden;
            line-height: 1.6;
            font-size: 14px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- BACKGROUND FX (SCANLINES & NOISE) --- */
        .scanlines {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 4px, 3px 100%;
            pointer-events: none;
            z-index: 9999;
            opacity: 0.6;
        }

        .noise {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyBAMAAADsEZWCAAAAGFBMVEUAAAA5OTkAAABMTExERERmZmYzMzNmZmYvP41FAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfmBwUQDw0u825TAAAAHWlUWHRDb21tZW50AAAAAABDcmVhdGVkIHdpdGggR0lNUGQuZQcAAABbSURBVDjL7dOxDcAgDAXRVkzABowBS2YBVsAmnSVj4Q6i/qP4010iKj5F559iJ65S816b1E5c40l6X+3Ew0y9b/biZqY+N/txM9P42+zHw0xjb/bjZabxt9mPl5n6B3D6Wv44K56WAAAAAElFTkSuQmCC');
            opacity: 0.05;
            pointer-events: none;
            z-index: 9998;
            animation: noise-anim 0.5s infinite linear;
        }

        @keyframes noise-anim {
            0% { background-position: 0 0; }
            100% { background-position: 100px 100px; }
        }

        /* --- HEADER & NAVIGATION --- */
        header {
            height: var(--nav-height);
            background: rgba(5, 5, 5, 0.95);
            border-bottom: 1px solid var(--border);
            position: fixed;
            top: 0; width: 100%;
            z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }

        .navbar {
            max-width: 1800px;
            margin: 0 auto;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: var(--text-main);
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 1.2rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            position: relative;
        }

        .logo img {
            height: 40px;
            filter: drop-shadow(0 0 5px var(--primary-glow));
            transition: 0.3s;
        }

        .logo:hover img {
            filter: drop-shadow(0 0 10px var(--primary));
            transform: scale(1.05);
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 5px;
            height: 100%;
        }

        .nav-links li a {
            color: var(--text-dim);
            text-decoration: none;
            font-size: 0.75rem;
            padding: 0 15px;
            height: 100%;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            border-bottom: 2px solid transparent;
        }

        .nav-links li a i { font-size: 1.1rem; margin-bottom: 2px; }
        
        .nav-links li a:hover, .nav-links li a.active {
            color: var(--primary);
            background: linear-gradient(to bottom, transparent 0%, rgba(230, 57, 70, 0.1) 100%);
            border-bottom-color: var(--primary);
            text-shadow: 0 0 8px var(--primary-glow);
        }

        .nav-text { 
            font-size: 0.6rem; 
            text-transform: uppercase; 
            font-weight: bold; 
            letter-spacing: 1px;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.3s;
        }

        .menu-toggle:hover {
            background: var(--primary);
            color: #fff;
        }

        /* --- MOBILE SIDEBAR --- */
        .mobile-sidebar {
            position: fixed;
            top: 0; left: -100%;
            width: var(--sidebar-width);
            height: 100%;
            background: var(--bg-panel);
            border-right: 1px solid var(--primary);
            z-index: 2000;
            transition: 0.4s ease;
            padding-top: 20px;
            display: flex;
            flex-direction: column;
        }

        .mobile-sidebar.open { left: 0; box-shadow: 10px 0 50px rgba(0,0,0,0.8); }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #222;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-header .logo img { height: 30px; }
        .sidebar-header .logo span { font-size: 1rem; }

        .sidebar-links { list-style: none; overflow-y: auto; flex: 1; }
        .sidebar-links li a {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--text-dim);
            text-decoration: none;
            transition: 0.2s;
            border-left: 4px solid transparent;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        .sidebar-links li a:hover {
            background: rgba(255,255,255,0.05);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .sidebar-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1999;
            display: none;
            backdrop-filter: blur(3px);
        }

        /* --- MAIN LAYOUT GRID --- */
        main {
            margin-top: var(--nav-height);
            padding: 20px;
            max-width: 1800px;
            margin-left: auto;
            margin-right: auto;
            display: grid;
            grid-template-columns: 320px 1fr 320px;
            grid-template-rows: auto auto 1fr;
            gap: 20px;
            flex: 1;
        }

        @media (max-width: 1200px) {
            main {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        /* --- NEWS TICKER --- */
        .news-ticker {
            grid-column: 1 / -1;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            height: 30px;
            overflow: hidden;
            white-space: nowrap;
            position: relative;
            display: flex;
            align-items: center;
            font-family: 'Orbitron';
            font-size: 0.7rem;
            color: var(--warning);
        }
        
        .ticker-track {
            display: inline-block;
            white-space: nowrap;
            animation: ticker-scroll 40s linear infinite;
            padding-left: 100%;
        }
        
        .ticker-item {
            display: inline-block;
            padding: 0 20px;
        }
        
        @keyframes ticker-scroll {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-100%, 0, 0); }
        }

        /* --- WIDGET / PANEL STYLES --- */
        .terminal-panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 4px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
        }

        .terminal-panel:hover {
            border-color: rgba(255,255,255,0.2);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .terminal-panel::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            opacity: 0.5;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }

        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.85rem;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-title i { font-size: 1rem; }

        /* --- GLITCH TEXT EFFECT --- */
        .glitch-text {
            position: relative;
            display: inline-block;
            color: #fff;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .glitch-text::before, .glitch-text::after {
            content: attr(data-text);
            position: absolute;
            top: 0; width: 100%; height: 100%;
            background: var(--bg-dark);
            clip: rect(0, 0, 0, 0);
        }

        .glitch-text::before {
            left: -2px;
            text-shadow: 2px 0 var(--secondary);
            animation: glitch-anim-1 2s infinite linear alternate-reverse;
        }

        .glitch-text::after {
            left: 2px;
            text-shadow: -2px 0 var(--primary);
            animation: glitch-anim-2 3s infinite linear alternate-reverse;
        }

        @keyframes glitch-anim-1 {
            0% { clip: rect(10px, 9999px, 20px, 0); }
            20% { clip: rect(45px, 9999px, 60px, 0); }
            40% { clip: rect(15px, 9999px, 30px, 0); }
            100% { clip: rect(80px, 9999px, 90px, 0); }
        }

        @keyframes glitch-anim-2 {
            0% { clip: rect(80px, 9999px, 90px, 0); }
            20% { clip: rect(10px, 9999px, 20px, 0); }
            40% { clip: rect(50px, 9999px, 60px, 0); }
            100% { clip: rect(5px, 9999px, 15px, 0); }
        }

        /* --- HERO SECTION --- */
        .hero {
            grid-column: 1 / -1;
            padding: 50px 20px;
            background: linear-gradient(180deg, rgba(5,5,5,0.8) 0%, rgba(5,5,5,1) 100%), 
                        url('https://images.unsplash.com/photo-1620121692029-d088224efc74?q=80&w=1600');
            background-size: cover;
            background-position: center;
            border: 1px solid var(--border);
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            z-index: 2;
        }

        .agent-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0,0,0,0.6);
            padding: 8px 25px;
            border-radius: 4px;
            border: 1px solid var(--primary);
            font-size: 0.85rem;
            z-index: 2;
            backdrop-filter: blur(5px);
        }

        .status-dot {
            width: 8px; height: 8px;
            background: var(--success);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--success);
            animation: pulse 1.5s infinite;
        }

        /* --- LOGS & FEEDS --- */
        .log-container {
            flex: 1;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
            font-size: 0.75rem;
            font-family: 'JetBrains+Mono', monospace;
            padding-right: 5px;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border: 1px solid #111;
        }

        .log-entry { 
            margin-bottom: 6px; 
            border-left: 2px solid var(--border); 
            padding-left: 10px; 
            animation: fadeIn 0.3s ease-out;
        }
        
        .log-time { color: var(--text-dim); }
        .log-tag { color: var(--primary); font-weight: bold; }
        .log-msg-success { color: var(--success); }
        .log-msg-warn { color: var(--warning); }
        .log-msg-danger { color: var(--danger); font-weight: bold; }
        
        .terminal-input-line {
            display: flex;
            border-top: 1px solid #222;
            padding-top: 5px;
            margin-top: 5px;
        }
        
        .terminal-prompt { color: var(--success); margin-right: 5px; }
        
        #cmd-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-family: 'JetBrains+Mono', monospace;
            font-size: 0.75rem;
            outline: none;
        }

        /* --- STAT CARDS --- */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-card {
            background: rgba(255,255,255,0.03);
            padding: 15px;
            border-radius: 4px;
            text-align: center;
            border: 1px solid transparent;
            transition: 0.3s;
        }
        .stat-card:hover { border-color: var(--primary); background: rgba(230, 57, 70, 0.05); }

        .stat-val { font-size: 1.5rem; color: var(--primary); font-weight: 700; display: block; }
        .stat-label { font-size: 0.6rem; color: var(--text-dim); text-transform: uppercase; }

        /* --- PROGRESS BARS --- */
        .integrity-bar {
            height: 4px;
            background: #222;
            width: 100%;
            margin-top: 10px;
            border-radius: 2px;
            overflow: hidden;
        }
        .integrity-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            transition: 0.5s;
            box-shadow: 0 0 10px var(--primary);
        }

        /* --- ACTIVE AGENTS LIST --- */
        .agent-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #1a1a1a;
            transition: 0.2s;
        }
        .agent-list-item:hover { background: rgba(255,255,255,0.02); }
        .agent-avatar {
            width: 30px; height: 30px;
            background: #222;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: var(--text-dim);
            border: 1px solid #333;
        }
        .agent-details { flex: 1; margin-left: 10px; }
        .agent-name { font-size: 0.8rem; font-weight: bold; display: block; }
        .agent-status { font-size: 0.65rem; color: var(--success); }

        /* --- AUDIO PLAYER WIDGET --- */
        .audio-visualizer {
            width: 100%;
            height: 60px;
            background: #000;
            border: 1px solid #222;
            margin-bottom: 10px;
            position: relative;
        }
        
        .audio-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .btn-audio {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
            width: 30px; height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        
        .btn-audio:hover { color: var(--primary); border-color: var(--primary); }
        .btn-audio.active { color: var(--success); border-color: var(--success); box-shadow: 0 0 10px var(--success); }

        /* --- OBJECTIVES LIST --- */
        .task-list {
            list-style: none;
            margin-top: 10px;
        }
        
        .task-item {
            display: flex;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.75rem;
            color: #ccc;
            transition: 0.2s;
        }
        
        .task-item:hover { background: rgba(255,255,255,0.02); }
        
        .task-checkbox {
            width: 14px; height: 14px;
            border: 1px solid var(--primary);
            margin-right: 10px;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }
        
        .task-checkbox.checked::after {
            content: '✓';
            font-size: 10px;
            color: var(--primary);
        }
        
        .task-item.completed { text-decoration: line-through; opacity: 0.5; }

        /* --- MINI GAME (DECRYPT) --- */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            margin-top: 10px;
        }
        
        .game-cell {
            aspect-ratio: 1;
            background: #111;
            border: 1px solid #333;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-family: 'Orbitron';
            font-size: 0.8rem;
            color: var(--text-dim);
            transition: 0.2s;
        }
        
        .game-cell:hover { background: #222; color: #fff; }
        .game-cell.active { background: var(--primary); color: #fff; box-shadow: 0 0 10px var(--primary); }
        .game-cell.success { background: var(--success); border-color: var(--success); }
        
        /* --- RECENT ACTIVITY --- */
        .recent-activity {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .activity-item {
            background: rgba(255, 255, 255, 0.02);
            padding: 10px;
            border-left: 3px solid var(--border);
            transition: 0.3s;
        }

        .activity-item:hover {
            border-color: var(--primary);
        }

        .activity-title {
            font-weight: bold;
            color: var(--text-highlight);
            font-size: 0.8rem;
            margin-bottom: 3px;
        }

        .activity-meta {
            font-size: 0.65rem;
            color: var(--text-dim);
        }

        /* --- MISSION BRIEFING --- */
        .mission-briefing {
            grid-column: 1 / -1;
        }

        .briefing-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .briefing-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            padding: 20px;
            text-decoration: none;
            color: var(--text-main);
            transition: 0.3s;
            border-radius: 4px;
        }

        .briefing-card:hover {
            background: var(--primary-dim);
            border-color: var(--primary);
            transform: translateY(-5px);
        }

        .briefing-card i {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .briefing-card h3 {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: var(--text-highlight);
        }

        .briefing-card p {
            font-size: 0.75rem;
            color: var(--text-dim);
        }

        /* --- BOTTOM NAVIGATION (MOBILE) --- */
        .bottom-nav {
            display: none;
            position: fixed;
            bottom: 0; left: 0; width: 100%;
            height: 60px;
            background: rgba(5, 5, 5, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border);
            z-index: 4000;
            justify-content: space-around;
            align-items: center;
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-dim);
            text-decoration: none;
            font-size: 0.6rem;
            gap: 4px;
            width: 100%; height: 100%;
        }
        
        .nav-item i { font-size: 1.2rem; margin-bottom: 2px; }
        .nav-item.active { color: var(--primary); }
        
        /* --- SETTINGS MODAL --- */
        .modal {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 6000;
            align-items: center; justify-content: center;
        }
        
        .modal-content {
            background: var(--bg-panel);
            border: 1px solid var(--primary);
            padding: 30px;
            width: 90%; max-width: 500px;
            box-shadow: 0 0 30px rgba(230, 57, 70, 0.2);
        }
        
        .setting-row {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 10px;
        }
        
        .toggle-switch {
            width: 40px; height: 20px; background: #333; border-radius: 10px;
            position: relative; cursor: pointer;
        }
        
        .toggle-switch::after {
            content: ''; position: absolute; top: 2px; left: 2px;
            width: 16px; height: 16px; background: #fff; border-radius: 50%;
            transition: 0.3s;
        }
        
        .toggle-switch.active { background: var(--success); }
        .toggle-switch.active::after { left: 22px; }

        /* --- RADAR WIDGET --- */
        .radar-container {
            width: 100%;
            aspect-ratio: 1;
            background: var(--radar-bg);
            border-radius: 50%;
            border: 2px solid var(--success);
            position: relative;
            overflow: hidden;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.2);
            background-image: 
                radial-gradient(transparent 30%, rgba(46, 204, 113, 0.3) 31%, transparent 32%),
                radial-gradient(transparent 60%, rgba(46, 204, 113, 0.3) 61%, transparent 62%),
                linear-gradient(0deg, transparent 49%, rgba(46, 204, 113, 0.3) 50%, transparent 51%),
                linear-gradient(90deg, transparent 49%, rgba(46, 204, 113, 0.3) 50%, transparent 51%);
        }

        .radar-sweep {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            border-radius: 50%;
            background: conic-gradient(from 0deg, transparent 0deg, rgba(46, 204, 113, 0.5) 30deg, transparent 30.1deg);
            animation: radar-spin 4s linear infinite;
            pointer-events: none;
        }

        .radar-blip {
            position: absolute;
            width: 6px; height: 6px;
            background: var(--danger);
            border-radius: 50%;
            box-shadow: 0 0 8px var(--danger);
            animation: blip-pulse 2s infinite;
        }

        @keyframes radar-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes blip-pulse { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: scale(2); } }

        /* --- DRONE FEED --- */
        .drone-panel {
            display: grid;
            grid-template-columns: 1fr 100px;
            gap: 10px;
            height: 200px;
        }

        .drone-view {
            background: #000;
            border: 1px solid #333;
            position: relative;
            overflow: hidden;
        }

        .drone-img {
            width: 100%; height: 100%; object-fit: cover;
            opacity: 0.8; filter: grayscale(0.5) contrast(1.2) sepia(0.2);
        }

        .drone-hud-overlay {
            position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            pointer-events: none;
        }

        .drone-hud-overlay::before {
            content: '+'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: rgba(255,255,255,0.5); font-size: 20px;
        }

        .drone-stats {
            position: absolute; bottom: 5px; left: 5px;
            font-family: monospace; font-size: 0.6rem; color: var(--success);
            background: rgba(0,0,0,0.6); padding: 2px 5px;
        }

        .drone-controls {
            display: flex; flex-direction: column; gap: 5px;
        }

        .drone-btn {
            flex: 1; background: #111; border: 1px solid #333; color: #888;
            font-size: 0.6rem; cursor: pointer; transition: 0.2s;
        }
        .drone-btn:hover, .drone-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }

        /* --- SECURITY KEYPAD --- */
        .keypad-container {
            background: #050505; padding: 15px; border-radius: 4px; border: 1px solid #333;
        }
        .keypad-display {
            background: #000; border: 1px solid var(--border); color: var(--primary);
            font-family: 'Orbitron'; font-size: 1.2rem; text-align: center; padding: 10px;
            margin-bottom: 10px; letter-spacing: 5px; height: 45px;
        }
        .keypad-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px;
        }
        .key-btn {
            background: #151515; border: 1px solid #333; color: #fff; padding: 10px;
            font-family: 'Orbitron'; cursor: pointer; transition: 0.2s;
        }
        .key-btn:hover { border-color: var(--primary); color: var(--primary); }
        .key-btn.clear { color: var(--warning); border-color: var(--warning); }
        .key-btn.enter { color: var(--success); border-color: var(--success); }

        /* --- NOTIFICATION DRAWER --- */
        .notif-drawer {
            position: fixed; top: 0; right: -350px; width: 320px; height: 100%;
            background: rgba(10, 10, 10, 0.98); border-left: 1px solid var(--primary);
            z-index: 6000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 20px; display: flex; flex-direction: column;
            box-shadow: -10px 0 50px rgba(0,0,0,0.8); backdrop-filter: blur(10px);
        }
        .notif-drawer.open { right: 0; }
        .notif-list { flex: 1; overflow-y: auto; margin-top: 20px; }
        .notif-item {
            background: rgba(255,255,255,0.03); border-left: 3px solid var(--border);
            padding: 10px; margin-bottom: 10px; font-size: 0.75rem; position: relative;
        }
        .notif-item.warn { border-color: var(--warning); }
        .notif-item.danger { border-color: var(--danger); }
        .notif-time { font-size: 0.6rem; color: var(--text-dim); display: block; margin-bottom: 3px; }

        /* --- CANVAS VISUALIZERS --- */
        canvas {
            width: 100%;
            height: 100px;
            background: #000;
            border: 1px solid #222;
            margin-top: 10px;
        }

        /* --- PUSH NOTIFICATION SYSTEM --- */
        .push-notification-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 5000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .push-alert {
            background: rgba(10, 10, 10, 0.95);
            border-left: 4px solid var(--primary);
            padding: 15px 20px;
            width: 300px;
            color: #fff;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            pointer-events: auto;
            animation: slideInRight 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .push-alert::after {
            content: "";
            position: absolute;
            bottom: 0; left: 0; height: 2px; width: 100%;
            background: var(--primary);
            animation: timeOut 5s linear forwards;
        }

        .push-title { font-family: 'Orbitron'; font-size: 0.8rem; color: var(--primary); margin-bottom: 5px; display: flex; justify-content: space-between; }
        .push-body { font-size: 0.75rem; color: #ccc; }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes timeOut {
            from { width: 100%; }
            to { width: 0%; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- FOOTER --- */
        footer {
            grid-column: 1 / -1;
            margin-top: 40px;
            padding: 40px 20px;
            border-top: 1px solid var(--border);
            text-align: center;
            font-size: 0.7rem;
            color: var(--text-dim);
            background: #080808;
        }
        
        .drawer-toggle {
            position: fixed; top: 80px; right: 0; background: var(--primary); color: #fff;
            padding: 10px 15px; border-radius: 4px 0 0 4px; cursor: pointer; z-index: 4000;
            font-size: 1.2rem; box-shadow: -5px 0 15px rgba(0,0,0,0.5);
        }

        /* --- RESPONSIVE QUERIES --- */
        @media (max-width: 1200px) {
            main { 
                grid-template-columns: 1fr 1fr; 
                grid-template-rows: auto auto auto;
            }
            .hero { grid-column: 1 / -1; }
            .side-module-left { grid-column: 1; }
            .side-module-right { grid-column: 2; }
            .main-module { grid-column: 1 / -1; grid-row: 3; }
        }

        @media (max-width: 900px) {
            main { grid-template-columns: 1fr; display: flex; flex-direction: column; }
            .nav-links { display: none; }
            .menu-toggle { display: block; }
            .hero h1 { font-size: 1.8rem; }
            .navbar { padding: 0 15px; }
            .news-ticker { display: none; } /* Hide ticker on very small screens to save space */
            .bottom-nav { display: flex; }
            main { padding-bottom: 80px; }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.4; }
            100% { opacity: 1; }
        }

        /* --- UTILS --- */
        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }
        .text-warning { color: var(--warning); }
        .text-dim { color: var(--text-dim); }
        .blink { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

    </style>
</head>
<body>

    <!-- VISUAL OVERLAYS -->
    <div class="scanlines"></div>
    <div class="noise"></div>
    <div class="sidebar-overlay" id="overlay" onclick="toggleSidebar()"></div>
    <div class="push-notification-container" id="push-container"></div>

    <!-- NOTIFICATION DRAWER TOGGLE -->
    <div class="drawer-toggle" onclick="toggleDrawer()">
        <i class="fa fa-bell"></i>
    </div>

    <!-- MOBILE SIDEBAR -->
    <aside class="mobile-sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <img src="logo.png" alt="Logo">
                <span>SYSTEM MENU</span>
            </div>
            <button class="menu-toggle" onclick="toggleSidebar()" style="display:block; border:none;">
                <i class="fa fa-times"></i>
            </button>
        </div>
        <ul class="sidebar-links">
                <li><a href="index.html"><i class="fa fa-home"></i><span class="nav-text">Home</span></a></li>
                <li><a href="forum.html"><i class="fa fa-comments"></i><span class="nav-text">Intel</span></a></li>
                <li><a href="sightings.html"><i class="fa fa-crosshairs"></i><span class="nav-text">Tracker</span></a></li>
                <li><a href="dinosaurs.html"><i class="fa fa-dna"></i><span class="nav-text">Species</span></a></li>
                <li><a href="users.html"><i class="fa fa-user-secret"></i><span class="nav-text">Agents</span></a></li>
                <li><a href="dms.html"><i class="fa fa-envelope"></i><span class="nav-text">DMs</span></a></li>
                <li><a href="blackmarket.html"><i class="fa fa-briefcase"></i><span class="nav-text">Market</span></a></li>
                <li><a href="vault.html"><i class="fa fa-lock"></i><span class="nav-text">Vault</span></a></li>
                <li><a href="profile.html"><i class="fa fa-cog"></i><span class="nav-text">System</span></a></li>
                <li id="admin-nav" style="display:none;"><a href="admin.html"><i class="fa fa-terminal"></i><span class="nav-text">Admin</span></a></li>
                <li><a href="login.html"><i class="fa fa-sign-in-alt"></i><span class="nav-text">Login</span></a></li>
        </ul>
        <div style="padding: 20px; margin-top: auto; border-top: 1px solid #222; font-size: 0.7rem; color: #555; text-align: center;">
            SECURE CONNECTION<br>V4.0.2 STABLE
        </div>
    </aside>

    <!-- DESKTOP HEADER -->
    <header>
        <nav class="navbar">
            <a href="index.html" class="logo">
                <img src="logo.png" alt="Dark Jurassic Logo">
                <span class="glitch-text" data-text="DARK JURASSIC">DARK JURASSIC</span>
            </a>

            <ul class="nav-links">
                <li><a href="index.html"><i class="fa fa-home"></i><span class="nav-text">Home</span></a></li>
                <li><a href="forum.html"><i class="fa fa-comments"></i><span class="nav-text">Intel</span></a></li>
                <li><a href="sightings.html"><i class="fa fa-crosshairs"></i><span class="nav-text">Tracker</span></a></li>
                <li><a href="dinosaurs.html"><i class="fa fa-dna"></i><span class="nav-text">Species</span></a></li>
                <li><a href="users.html"><i class="fa fa-user-secret"></i><span class="nav-text">Agents</span></a></li>
                <li><a href="dms.html"><i class="fa fa-envelope"></i><span class="nav-text">DMs</span></a></li>
                <li><a href="blackmarket.html"><i class="fa fa-briefcase"></i><span class="nav-text">Market</span></a></li>
                <li><a href="vault.html"><i class="fa fa-lock"></i><span class="nav-text">Vault</span></a></li>
                <li><a href="profile.html"><i class="fa fa-cog"></i><span class="nav-text">System</span></a></li>
                <li id="admin-nav" style="display:none;"><a href="admin.html"><i class="fa fa-terminal"></i><span class="nav-text">Admin</span></a></li>
                <li><a href="login.html"><i class="fa fa-sign-in-alt"></i><span class="nav-text">Login</span></a></li>
            </ul>

            <button class="menu-toggle" onclick="toggleSidebar()">
                <i class="fa fa-bars"></i>
            </button>
        </nav>
    </header>

    <!-- MAIN CONTENT GRID -->
    <main>
        <!-- NEWS TICKER -->
        <div class="news-ticker">
            <div class="ticker-track">
                <span class="ticker-item">/// SYSTEM ALERT: SECTOR 4 CONTAINMENT BREACH CONFIRMED ///</span>
                <span class="ticker-item">/// WEATHER WARNING: HURRICANE 'ISABELLA' APPROACHING ISLA SORNA ///</span>
                <span class="ticker-item">/// MARKET UPDATE: BIOSYN STOCK DOWN 14.2% ///</span>
                <span class="ticker-item">/// NEW BOUNTY: VELOCIRAPTOR 'BLUE' - 50,000 XP ///</span>
                <span class="ticker-item">/// INGEN SECURITY PROTOCOL: LEVEL 5 LOCKDOWN IN EFFECT ///</span>
            </div>
        </div>

        <!-- HERO SECTION -->
        <section class="hero">
            <h1 class="glitch-text" data-text="WELCOME, AGENT">WELCOME, AGENT</h1>
            <div class="agent-badge">
                <div class="status-dot"></div>
                <span id="agent-display">INITIATING HANDSHAKE...</span>
            </div>
            <p style="margin-top: 15px; color: var(--text-dim); font-size: 0.8rem; max-width: 600px;">
                You are connected to the Dark Jurassic command and control network. Your mission is to monitor the situation, gather intelligence, and report any anomalies. Use the links below to get started.
            </p>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <a href="forum.html" style="text-decoration: none; background: var(--primary); padding: 10px 20px; color: #fff; border-radius: 4px; font-size: 0.8rem; transition: 0.3s;">
                    <i class="fa fa-comments"></i> INTEL FORUM
                </a>
                <a href="sightings.html" style="text-decoration: none; background: var(--secondary); padding: 10px 20px; color: #000; border-radius: 4px; font-size: 0.8rem; transition: 0.3s;">
                    <i class="fa fa-crosshairs"></i> LIVE TRACKER
                </a>
                <a href="dinosaurs.html" style="text-decoration: none; background: #fff; padding: 10px 20px; color: #000; border-radius: 4px; font-size: 0.8rem; transition: 0.3s;">
                    <i class="fa fa-dna"></i> SPECIES DATABASE
                </a>
            </div>
        </section>

        <!-- MISSION BRIEFING SECTION -->
        <section class="mission-briefing">
            <div class="terminal-panel">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa fa-book"></i> MISSION BRIEFING</span>
                </div>
                <p style="color: var(--text-dim); font-size: 0.8rem; margin-bottom: 20px;">
                    Your primary objective is to monitor the volatile situation on the islands. Gather intelligence from fellow agents, track the movement of assets, and familiarize yourself with the threats we face. Stay sharp, stay vigilant, and trust no one.
                </p>
                <div class="briefing-cards">
                    <a href="forum.html" class="briefing-card">
                        <i class="fa fa-comments"></i>
                        <h3>GATHER INTELLIGENCE</h3>
                        <p>Access the Intel forum to read and share the latest information from agents in the field.</p>
                    </a>
                    <a href="sightings.html" class="briefing-card">
                        <i class="fa fa-crosshairs"></i>
                        <h3>TRACK ASSETS</h3>
                        <p>Use the live tracker to monitor the location and status of all biological assets.</p>
                    </a>
                    <a href="dinosaurs.html" class="briefing-card">
                        <i class="fa fa-dna"></i>
                        <h3>KNOW YOUR ENEMY</h3>
                        <p>Study the species database to understand the capabilities and weaknesses of the threats.</p>
                    </a>
                    <a href="profile.html" class="briefing-card">
                        <i class="fa fa-user"></i>
                        <h3>MANAGE YOUR PROFILE</h3>
                        <p>Update your agent profile, manage your settings, and track your progress.</p>
                    </a>
            </div>
        </section>

        <!-- RECENT ACTIVITY SECTION -->
        <section class="recent-activity">
            <div class="activity-column">
                <div class="terminal-panel">
                    <div class="panel-header">
                        <span class="panel-title"><i class="fa fa-comments"></i> RECENT INTEL</span>
                    </div>
                    <div id="recent-intel-list" class="activity-list">
                        <!-- JS will populate this -->
                    </div>
                </div>
            </div>
            <div class="activity-column">
                <div class="terminal-panel">
                    <div class="panel-header">
                        <span class="panel-title"><i class="fa fa-crosshairs"></i> LATEST SIGHTINGS</span>
                    </div>
                    <div id="recent-sightings-list" class="activity-list">
                        <!-- JS will populate this -->
                    </div>
                </div>
            </div>
            <div class="activity-column">
                <div class="terminal-panel">
                    <div class="panel-header">
                        <span class="panel-title"><i class="fa fa-dna"></i> NEW SPECIES</span>
                    </div>
                    <div id="recent-dinosaurs-list" class="activity-list">
                        <!-- JS will populate this -->
                    </div>
                </div>
            </div>
        </section>

        <!-- LEFT COLUMN: SYSTEM METRICS -->
        <div class="side-module-left">
            
            <!-- System Health -->
            <div class="terminal-panel">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa fa-microchip"></i> SYSTEM METRICS</span>
                    <i class="fa fa-circle blink text-success" style="font-size: 0.5rem;"></i>
                </div>
                <div class="stat-grid">
                    <div class="stat-card">
                        <span class="stat-val" id="agent-count">--</span>
                        <span class="stat-label">Agents Active</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-val" id="threat-level">HIGH</span>
                        <span class="stat-label">Threat Level</span>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <span class="stat-label">Network Integrity: <span id="integrity-val">98.4%</span></span>
                    <div class="integrity-bar"><div class="integrity-fill" id="integrity-fill"></div></div>
                </div>
                <div style="margin-top: 20px;">
                    <span class="stat-label">Satellite Uplink (Echo-7)</span>
                    <div class="integrity-bar"><div class="integrity-fill" style="width: 65%; background: var(--accent-blue);" id="uplink-fill"></div></div>
                </div>
            </div>

            <!-- OBJECTIVES WIDGET -->
            <div class="terminal-panel" style="margin-top: 20px;">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa fa-tasks"></i> DAILY OBJECTIVES</span>
                    <span style="font-size: 0.6rem; color: var(--text-dim);">RESET: 04:00</span>
                </div>
                <ul class="task-list" id="task-list">
                    <!-- Populated by JS -->
                </ul>
                <button onclick="resetTasks()" style="margin-top: 10px; background: transparent; border: 1px solid var(--border); color: var(--text-dim); font-size: 0.6rem; cursor: pointer; padding: 5px;">RESET LOGS</button>
            </div>

            <!-- Hardware Status -->
            <div class="terminal-panel" style="margin-top: 20px;">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa fa-server"></i> SERVER LOAD</span>
                </div>
                <canvas id="loadCanvas"></canvas>
                <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-dim); margin-top: 5px;">
                    <span>CPU: <span id="cpu-val">34%</span></span>
                    <span>RAM: <span id="ram-val">12GB</span></span>
                </div>
            </div>

            <!-- TACTICAL RADAR -->
            <div class="terminal-panel" style="margin-top: 20px;">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa fa-crosshairs"></i> PROXIMITY RADAR</span>
                    <span style="font-size: 0.6rem; color: var(--danger);">RANGE: 5KM</span>
                </div>
                <div class="radar-container" id="radar-screen">
                    <div class="radar-sweep"></div>
                    <!-- Blips injected via JS -->
                </div>
            </div>

            <!-- Weather / Environment -->
            <div class="terminal-panel" style="margin-top: 20px;">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa fa-cloud-rain"></i> ISLA NUBLAR ENV</span>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <i class="fa fa-cloud-showers-heavy" style="font-size: 2rem; color: var(--accent-blue);"></i>
                    <div>
                        <div style="font-size: 1.2rem; font-weight: bold;">24°C</div>
                        <div style="font-size: 0.7rem; color: var(--text-dim);">HUMIDITY: 88% | WIND: 12KT</div>
                    </div>
                </div>
            </div>

        </div>

        <!-- MIDDLE COLUMN: MAIN FEED & MAP -->
        <div class="main-module">
            
            <!-- Live Map Placeholder -->
            <div class="terminal-panel">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa fa-globe"></i> LIVE SATELLITE FEED</span>
                    <span style="font-size: 0.6rem; color: var(--primary);">LIVE FEED</span>
                </div>
                <div id="dashboard-map" style="height: 300px; width: 100%; background: #000; border: 1px solid #222;"></div>
            </div>

            <!-- Main Terminal Logs -->
            <div class="terminal-panel" style="margin-top: 20px; flex: 1;">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa fa-terminal"></i> SYSTEM LOGS</span>
                    <div style="display: flex; gap: 5px;">
                        <div style="width: 8px; height: 8px; background: #333; border-radius: 50%;"></div>
                        <div style="width: 8px; height: 8px; background: #333; border-radius: 50%;"></div>
                        <div style="width: 8px; height: 8px; background: #333; border-radius: 50%;"></div>
                    </div>
                </div>
                <div class="log-container" id="terminal-logs">
                    <!-- JS Injected Logs -->
                </div>
                <div class="terminal-input-line">
                    <span class="terminal-prompt">root@dj-sys:~#</span>
                    <input type="text" id="cmd-input" placeholder="Enter command..." autocomplete="off">
                </div>
            </div>

            <!-- DRONE CONTROL -->
            <div class="terminal-panel" style="margin-top: 20px;">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa fa-plane"></i> DRONE SURVEILLANCE</span>
                    <span style="font-size: 0.6rem; color: var(--success);">ONLINE</span>
                </div>
                <div class="drone-panel">
                    <div class="drone-view">
                        <img src="https://images.unsplash.com/photo-1473968512647-3e447244af8f?q=80&w=1000" class="drone-img" id="drone-feed-img">
                        <div class="drone-hud-overlay"></div>
                        <div class="drone-stats" id="drone-stats">BAT: 87% | ALT: 450ft | SIG: STRONG</div>
                    </div>
                    <div class="drone-controls">
                        <button class="drone-btn active" onclick="switchDrone('ALPHA')">ALPHA</button>
                        <button class="drone-btn" onclick="switchDrone('BRAVO')">BRAVO</button>
                        <button class="drone-btn" onclick="switchDrone('CHARLIE')">CHARLIE</button>
                        <button class="drone-btn" style="margin-top: auto; color: var(--danger); border-color: var(--danger);" onclick="rtbDrone()">R.T.B.</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN: AGENTS & ALERTS -->
        <div class="side-module-right">
            
            <!-- Active Agents -->
            <div class="terminal-panel">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa fa-users"></i> ACTIVE AGENTS</span>
                </div>
                <div id="active-agents-list" style="max-height: 200px; overflow-y:auto;">
                    <div style="padding: 20px; text-align: center; color: var(--text-dim);">Scanning Network...</div>
                </div>
            </div>

            <!-- COMMS INTERCEPT (Audio) -->
            <div class="terminal-panel" style="margin-top: 20px;">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa fa-headphones"></i> COMMS INTERCEPT</span>
                    <span style="font-size: 0.6rem; color: var(--danger);">ENCRYPTED</span>
                </div>
                <canvas id="audioVisualizer" class="audio-visualizer"></canvas>
                <div class="audio-controls">
                    <div style="font-size: 0.7rem; color: var(--text-dim);">FREQ: 104.5 MHz</div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn-audio" onclick="toggleAudio()"><i class="fa fa-play" id="audio-icon"></i></button>
                        <button class="btn-audio" onclick="scanFreq()"><i class="fa fa-sync"></i></button>
                        <button class="btn-audio" onclick="openSettings()"><i class="fa fa-cog"></i></button>
                    </div>
                </div>
            </div>

            <!-- Security Alert -->
            <div class="terminal-panel" style="margin-top: 20px;">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa fa-shield-alt"></i> SECURITY STATUS</span>
                </div>
                <div style="background: rgba(230, 57, 70, 0.1); border: 1px solid var(--primary); padding: 15px; border-radius: 4px;">
                    <div style="color: var(--primary); font-weight: bold; font-size: 0.8rem; margin-bottom: 5px;">
                        <i class="fa fa-exclamation-triangle"></i> BREACH DETECTED
                    </div>
                    <p style="font-size: 0.7rem; color: #ccc;">
                        Unauthorized biological signatures detected in Sector 4. All personnel advised to maintain radio silence.
                    </p>
                </div>
            </div>

            <!-- SECURITY KEYPAD -->
            <div class="terminal-panel" style="margin-top: 20px;">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa fa-lock"></i> LEVEL 5 ACCESS</span>
                </div>
                <div class="keypad-container">
                    <div class="keypad-display" id="keypad-display">----</div>
                    <div class="keypad-grid">
                        <button class="key-btn" onclick="keyPress(1)">1</button>
                        <button class="key-btn" onclick="keyPress(2)">2</button>
                        <button class="key-btn" onclick="keyPress(3)">3</button>
                        <button class="key-btn" onclick="keyPress(4)">4</button>
                        <button class="key-btn" onclick="keyPress(5)">5</button>
                        <button class="key-btn" onclick="keyPress(6)">6</button>
                        <button class="key-btn" onclick="keyPress(7)">7</button>
                        <button class="key-btn" onclick="keyPress(8)">8</button>
                        <button class="key-btn" onclick="keyPress(9)">9</button>
                        <button class="key-btn clear" onclick="keyClear()">C</button>
                        <button class="key-btn" onclick="keyPress(0)">0</button>
                        <button class="key-btn enter" onclick="keyEnter()">E</button>
                    </div>
                </div>
            </div>

            <!-- MINI GAME: DECRYPT -->
            <div class="terminal-panel" style="margin-top: 20px;">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa fa-gamepad"></i> SYSTEM OVERRIDE</span>
                </div>
                <div style="font-size: 0.7rem; color: var(--text-dim); text-align: center;">MATCH THE SEQUENCE</div>
                <div class="game-grid" id="game-grid">
                    <!-- Generated by JS -->
                </div>
                <button onclick="startGame()" style="width: 100%; margin-top: 10px; background: var(--primary); border: none; color: #fff; padding: 5px; cursor: pointer; font-family: 'Orbitron';">INITIATE HACK</button>
            </div>

            <!-- Quick Links -->
            <div class="terminal-panel" style="margin-top: 20px;">
                <div class="panel-header">
                    <span class="panel-title"><i class="fa fa-bolt"></i> QUICK ACCESS</span>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <a href="forum.html" style="text-decoration: none; background: #111; padding: 10px; text-align: center; border: 1px solid #333; color: #fff; font-size: 0.7rem; transition: 0.2s; display: block;">
                        <i class="fa fa-bullhorn" style="color: var(--accent-blue);"></i><br>BROADCAST
                    </a>
                    <a href="sightings.html" style="text-decoration: none; background: #111; padding: 10px; text-align: center; border: 1px solid #333; color: #fff; font-size: 0.7rem; transition: 0.2s; display: block;">
                        <i class="fa fa-eye" style="color: var(--success);"></i><br>REPORT
                    </a>
                    <a href="blackmarket.html" style="text-decoration: none; background: #111; padding: 10px; text-align: center; border: 1px solid #333; color: #fff; font-size: 0.7rem; transition: 0.2s; display: block;">
                        <i class="fa fa-shopping-cart" style="color: var(--warning);"></i><br>BUY XP
                    </a>
                    <a href="vault.html" style="text-decoration: none; background: #111; padding: 10px; text-align: center; border: 1px solid #333; color: #fff; font-size: 0.7rem; transition: 0.2s; display: block;">
                        <i class="fa fa-file-code" style="color: var(--primary);"></i><br>FILES
                    </a>
                </div>
            </div>

        </div>
    </main>

    <!-- NOTIFICATION DRAWER -->
    <div class="notif-drawer" id="notifDrawer">
        <div class="panel-header">
            <span class="panel-title">NOTIFICATION LOG</span>
            <i class="fa fa-times" style="cursor: pointer;" onclick="toggleDrawer()"></i>
        </div>
        <div class="notif-list" id="notifList">
            <!-- Populated by JS -->
        </div>
        <button onclick="clearNotifs()" style="margin-top: 10px; background: transparent; border: 1px solid var(--danger); color: var(--danger); padding: 8px; cursor: pointer;">CLEAR HISTORY</button>
    </div>

    <!-- BOTTOM NAVIGATION (MOBILE) -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item active"><i class="fa fa-home"></i><span>HOME</span></a>
        <a href="sightings.html" class="nav-item"><i class="fa fa-crosshairs"></i><span>MAP</span></a>
        <a href="forum.html" class="nav-item"><i class="fa fa-comments"></i><span>INTEL</span></a>
        <a href="dms.html" class="nav-item"><i class="fa fa-envelope"></i><span>COMMS</span></a>
        <a href="profile.html" class="nav-item"><i class="fa fa-user"></i><span>ID</span></a>
    </nav>

    <!-- SETTINGS MODAL -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="panel-header">
                <span class="panel-title">SYSTEM CONFIGURATION</span>
                <i class="fa fa-times" style="cursor: pointer;" onclick="closeSettings()"></i>
            </div>
            <div class="setting-row">
                <span>AUDIO FEEDBACK</span>
                <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
            </div>
            <div class="setting-row">
                <span>HIGH CONTRAST MODE</span>
                <div class="toggle-switch" onclick="toggleSetting(this)"></div>
            </div>
            <div class="setting-row">
                <span>PUSH NOTIFICATIONS</span>
                <div class="toggle-switch active" onclick="toggleSetting(this)"></div>
            </div>
            <button onclick="closeSettings()" style="width: 100%; padding: 10px; background: var(--primary); border: none; color: #fff; font-family: 'Orbitron'; cursor: pointer;">SAVE & EXIT</button>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 DARK JURASSIC NETWORK. UNAUTHORIZED USE IS A VIOLATION OF INGEN PROTOCOLS.</p>
        <p style="margin-top: 10px; opacity: 0.5; font-size: 0.6rem;">
            SYSTEM VERSION 4.0.2 | ENCRYPTION: AES-256 | SERVER: ISLA_NUBLAR_MAIN
        </p>
    </footer>

    <script>
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyBxYUTNlBuhPQ2neLPAYCLDg0e-J76DIuU",
            authDomain: "dark-jurassic-378b5.firebaseapp.com",
            databaseURL: "https://dark-jurassic-378b5-default-rtdb.firebaseio.com/",
            projectId: "dark-jurassic-378b5",
            storageBucket: "dark-jurassic-378b5.firebasestorage.app",
            messagingSenderId: "144100722100",
            appId: "1:144100722100:web:be3b4690724a7a117fdee1"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // --- GLOBAL VARIABLES ---
        let currentAgent = "GUEST_USER";
        let myUsername = "";
        let isSidebarOpen = false;
        let isDrawerOpen = false;
        let map;
        let audioContext, analyser, dataArray, canvasCtx, audioAnimationId;
        let isAudioPlaying = false;
        let gameSequence = [], playerSequence = [];

        // --- AUTHENTICATION HANDLER ---
        auth.onAuthStateChanged(user => {
            if (user) {
                myUsername = user.email.split('@')[0].replace(/\./g, '_');
                
                // Fetch Profile Data
                db.ref('users/' + myUsername).on('value', snap => {
                    const data = snap.val();
                    currentAgent = data?.displayName || myUsername;
                    document.getElementById('agent-display').innerText = `AGENT: ${currentAgent.toUpperCase()} [ONLINE]`;
                    document.getElementById('agent-display').classList.add('text-success');
                    
                    // Only log login once per session load
                    if (!window.sessionLogged) {
                        addLog(`Connection established for Agent ${currentAgent}.`, "success");
                        window.sessionLogged = true;
                    }
                });
                
                // Set Online Status
                db.ref('status/' + myUsername).set({
                    name: currentAgent,
                    online: true,
                    lastSeen: firebase.database.ServerValue.TIMESTAMP
                });
                db.ref('status/' + myUsername).onDisconnect().remove();

            } else {
                document.getElementById('agent-display').innerText = "UNAUTHORIZED ACCESS - READ ONLY";
                document.getElementById('agent-display').classList.add('text-danger');
                addLog("Warning: Anonymous connection detected. Functionality limited.", "warn");
                
                // Optional: Redirect to login after delay
                // setTimeout(() => window.location.href = 'login.html', 5000);
            }
        });

        // --- UI CONTROLS ---
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            isSidebarOpen = !isSidebarOpen;
            
            if (isSidebarOpen) {
                sidebar.classList.add('open');
                overlay.style.display = 'block';
            } else {
                sidebar.classList.remove('open');
                overlay.style.display = 'none';
            }
        }

        function toggleDrawer() {
            const drawer = document.getElementById('notifDrawer');
            isDrawerOpen = !isDrawerOpen;
            if (isDrawerOpen) {
                drawer.classList.add('open');
            } else {
                drawer.classList.remove('open');
            }
        }

        // --- DATA LISTENERS ---

        // 1. Total Agent Count
        db.ref('users').on('value', snap => {
            const count = snap.numChildren();
            document.getElementById('agent-count').innerText = count;
        });

        // 2. Active Agents List
        db.ref('status').on('value', snap => {
            const container = document.getElementById('active-agents-list');
            container.innerHTML = "";
            
            if (!snap.exists()) {
                container.innerHTML = '<div style="padding:15px; text-align:center; color:#555;">No active signals.</div>';
                return;
            }

            snap.forEach(child => {
                const agent = child.val();
                const name = agent.name || child.key;
                
                const div = document.createElement('div');
                div.className = 'agent-list-item';
                div.innerHTML = `
                    <div style="display:flex; align-items:center;">
                        <div class="agent-avatar">${name.charAt(0).toUpperCase()}</div>
                        <div class="agent-details">
                            <span class="agent-name">@${name}</span>
                            <span class="agent-status">ONLINE</span>
                        </div>
                    </div>
                    <i class="fa fa-wifi text-success" style="font-size:0.7rem;"></i>
                `;
                container.appendChild(div);
            });
        });

        // 3. Push Notification System (Listening to 'alerts' node)
        db.ref('alerts').limitToLast(1).on('child_added', snap => {
            const alert = snap.val();
            // Only show if timestamp is recent (within last minute) to avoid spam on load
            const now = Date.now();
            if (alert.timestamp && now - alert.timestamp < 60000) {
                showPushNotification(alert.title, alert.message, alert.type);
                addNotificationToDrawer(alert.title, alert.message, alert.type);
                addLog(`ALERT RECEIVED: ${alert.title}`, "danger");
            }
        });

        // 4. Recent Intel (Forum)
        db.ref('forum_threads').limitToLast(1).on('child_added', snap => {
            const thread = snap.val();
            // Check if recent to avoid flood
            if (Date.now() - thread.timestamp < 30000) {
                addLog(`New Intel: "${thread.title}" uploaded by ${thread.author}`, "info");
                showPushNotification("NEW INTEL", `Agent ${thread.author} posted: ${thread.title}`, "info");
                addNotificationToDrawer("NEW INTEL", `Agent ${thread.author} posted: ${thread.title}`, "info");
            }
        });

        // --- LOGGING SYSTEM ---
        function addLog(msg, type = 'info') {
            const logBox = document.getElementById('terminal-logs');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            const now = new Date();
            const time = `[${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}:${now.getSeconds().toString().padStart(2,'0')}]`;
            
            let tag = "SYS";
            let colorClass = "";
            
            if(type === 'warn') { tag = "WARN"; colorClass = "log-msg-warn"; }
            if(type === 'success') { tag = "OK"; colorClass = "log-msg-success"; }
            if(type === 'danger') { tag = "CRIT"; colorClass = "log-msg-danger"; }
            if(type === 'info') { tag = "INFO"; colorClass = "text-highlight"; }

            entry.innerHTML = `<span class="log-time">${time}</span> <span class="log-tag">[${tag}]</span> <span class="${colorClass}">${msg}</span>`;
            logBox.prepend(entry);

            // Limit log history
            if(logBox.children.length > 60) logBox.removeChild(logBox.lastChild);
        }

        // --- MOCK FILE SYSTEM FOR TERMINAL ---
        const fileSystem = {
            'root': {
                'readme.txt': 'Welcome to Dark Jurassic OS v4.0. Unauthorized access is prohibited.',
                'agents.list': 'ENCRYPTED. USE KEYPAD TO UNLOCK.',
                'system.log': 'All systems nominal. Sector 4 sensors offline.',
                'bin': {
                    'nuke.exe': 'PERMISSION DENIED',
                    'trace.exe': 'Tracing...'
                }
            }
        };
        let currentDir = fileSystem['root'];
        let path = '/';

        function resolvePath(cmd) {
            // Simplified path resolution
            return currentDir[cmd] || null;
        }

        // --- TERMINAL INPUT ---
        document.getElementById('cmd-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                const cmd = this.value.trim().toLowerCase();
                addLog(`root@dj-sys:~# ${cmd}`, "dim");
                processCommand(cmd);
                this.value = '';
            }
        });

        function processCommand(cmd) {
            const parts = cmd.split(' ');
            switch(parts[0]) {
                case 'help':
                    addLog("AVAILABLE COMMANDS: HELP, CLEAR, SCAN, STATUS, REBOOT, WHOAMI, LS, CAT, DATE", "info");
                    break;
                case 'clear':
                    document.getElementById('terminal-logs').innerHTML = '';
                    break;
                case 'scan':
                    addLog("INITIATING DEEP SCAN...", "warn");
                    setTimeout(() => addLog("SCAN COMPLETE. 0 THREATS FOUND.", "success"), 2000);
                    break;
                case 'status':
                    addLog("SYSTEM INTEGRITY: 98%. ALL SYSTEMS NOMINAL.", "success");
                    break;
                case 'reboot':
                    location.reload();
                    break;
                case 'whoami':
                    addLog(`CURRENT USER: ${currentAgent}`, "info");
                    break;
                case 'ls':
                    const files = Object.keys(currentDir).map(k => typeof currentDir[k] === 'object' ? k + '/' : k).join('  ');
                    addLog(files, "info");
                    break;
                case 'cat':
                    if (parts[1] && currentDir[parts[1]] && typeof currentDir[parts[1]] === 'string') {
                        addLog(currentDir[parts[1]], "success");
                    } else {
                        addLog("FILE NOT FOUND OR IS A DIRECTORY", "danger");
                    }
                    break;
                case 'date':
                    addLog(new Date().toString(), "info");
                    break;
                default:
                    addLog(`COMMAND NOT FOUND: ${parts[0]}`, "danger");
            }
        }

        // --- LEAFLET MAP ---
        function initMap() {
            if(document.getElementById('dashboard-map')) {
                map = L.map('dashboard-map', {
                    center: [9.0, -84.0], // Costa Rica approx
                    zoom: 6,
                    zoomControl: false,
                    attributionControl: false,
                    maxBounds: [[-90, -180], [90, 180]],
                    maxBoundsViscosity: 1.0
                });

                // Dark Matter Tiles
                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                    maxZoom: 19,
                    noWrap: true
                }).addTo(map);

                // Add some fake markers
                const locations = [
                    { lat: 9.1, lng: -84.1, type: 'danger' },
                    { lat: 8.9, lng: -83.8, type: 'warning' },
                    { lat: 9.2, lng: -84.2, type: 'success' }
                ];

                locations.forEach(loc => {
                    const color = loc.type === 'danger' ? '#ff0000' : (loc.type === 'warning' ? '#f1c40f' : '#2ecc71');
                    L.circleMarker([loc.lat, loc.lng], {
                        radius: 5,
                        fillColor: color,
                        color: color,
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 0.8
                    }).addTo(map);
                });
            }
        }

        // --- AUDIO VISUALIZER (Simulated) ---
        function initAudio() {
            const canvas = document.getElementById('audioVisualizer');
            canvasCtx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            drawVisualizer();
        }

        function drawVisualizer() {
            const width = document.getElementById('audioVisualizer').width;
            const height = document.getElementById('audioVisualizer').height;
            canvasCtx.clearRect(0, 0, width, height);
            
            const bars = 30;
            const barWidth = width / bars;
            
            for(let i=0; i<bars; i++) {
                const barHeight = isAudioPlaying ? Math.random() * height : 2;
                const x = i * barWidth;
                const y = height - barHeight;
                
                canvasCtx.fillStyle = isAudioPlaying ? '#00d4ff' : '#333';
                canvasCtx.fillRect(x, y, barWidth - 2, barHeight);
            }
            
            if(isAudioPlaying) requestAnimationFrame(drawVisualizer);
        }

        function toggleAudio() {
            isAudioPlaying = !isAudioPlaying;
            const icon = document.getElementById('audio-icon');
            icon.className = isAudioPlaying ? 'fa fa-pause' : 'fa fa-play';
            if(isAudioPlaying) drawVisualizer();
            else drawVisualizer(); // Draw once to reset to flat
        }

        function scanFreq() {
            addLog("SCANNING FREQUENCIES...", "info");
            setTimeout(() => addLog("SIGNAL LOCKED: 104.5 MHz (ENCRYPTED)", "success"), 1500);
        }

        // --- OBJECTIVES SYSTEM ---
        const tasks = [
            "Review Sector 7 Surveillance Logs",
            "Update Agent Profile Bio",
            "Check Black Market for new items",
            "Verify encryption keys"
        ];

        function initTasks() {
            const list = document.getElementById('task-list');
            list.innerHTML = "";
            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.className = 'task-item';
                li.innerHTML = `
                    <div class="task-checkbox" onclick="toggleTask(this)"></div>
                    <span>${task}</span>
                `;
                list.appendChild(li);
            });
        }

        function toggleTask(el) {
            el.classList.toggle('checked');
            el.parentElement.classList.toggle('completed');
            if(el.classList.contains('checked')) {
                addLog("OBJECTIVE COMPLETED", "success");
            }
        }

        function resetTasks() {
            initTasks();
            addLog("DAILY OBJECTIVES RESET", "info");
        }

        // --- PUSH NOTIFICATION UI ---
        function showPushNotification(title, message, type = 'info') {
            const container = document.getElementById('push-container');
            
            const alert = document.createElement('div');
            alert.className = 'push-alert';
            
            // Color coding based on type
            let icon = 'fa-info-circle';
            let color = 'var(--primary)';
            
            if (type === 'success') { icon = 'fa-check-circle'; color = 'var(--success)'; }
            if (type === 'warn') { icon = 'fa-exclamation-triangle'; color = 'var(--warning)'; }
            
            alert.style.borderLeftColor = color;
            
            alert.innerHTML = `
                <div class="push-title" style="color:${color}">
                    <span><i class="fa ${icon}"></i> ${title}</span>
                    <span style="font-size:0.6rem; opacity:0.7;">NOW</span>
                </div>
                <div class="push-body">${message}</div>
            `;
            
            container.appendChild(alert);
            
            // Remove after 5 seconds
            setTimeout(() => {
                alert.style.animation = 'slideInRight 0.4s reverse forwards';
                setTimeout(() => alert.remove(), 400);
            }, 5000);
        }

        function addNotificationToDrawer(title, message, type) {
            const list = document.getElementById('notifList');
            const item = document.createElement('div');
            item.className = `notif-item ${type}`;
            const time = new Date().toLocaleTimeString();
            item.innerHTML = `
                <span class="notif-time">${time}</span>
                <div style="font-weight:bold; color:var(--primary); margin-bottom:2px;">${title}</div>
                <div>${message}</div>
            `;
            list.prepend(item);
        }

        function clearNotifs() {
            document.getElementById('notifList').innerHTML = '';
        }

        // --- CANVAS VISUALIZER (Server Load) ---
        const canvas = document.getElementById('loadCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let dataPoints = [];
        const maxPoints = 50;

        function resizeCanvas() {
            width = canvas.width = canvas.offsetWidth;
            height = canvas.height = canvas.offsetHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Init data
        for(let i=0; i<maxPoints; i++) dataPoints.push(Math.random() * 50 + 20);

        function drawChart() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, width, height);
            
            // Grid
            ctx.strokeStyle = '#111';
            ctx.beginPath();
            for(let i=0; i<width; i+=20) { ctx.moveTo(i,0); ctx.lineTo(i,height); }
            for(let i=0; i<height; i+=20) { ctx.moveTo(0,i); ctx.lineTo(width,i); }
            ctx.stroke();

            // Update Data
            dataPoints.shift();
            const last = dataPoints[dataPoints.length-1];
            let next = last + (Math.random() - 0.5) * 20;
            if(next < 10) next = 10;
            if(next > 90) next = 90;
            dataPoints.push(next);

            // Update Text UI
            document.getElementById('cpu-val').innerText = Math.floor(next) + "%";
            
            // Draw Line
            ctx.strokeStyle = '#e63946';
            ctx.lineWidth = 2;
            ctx.beginPath();
            const step = width / (maxPoints - 1);
            
            for(let i=0; i<maxPoints; i++) {
                const x = i * step;
                const y = height - (dataPoints[i] / 100 * height);
                if(i===0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Fill
            ctx.lineTo(width, height);
            ctx.lineTo(0, height);
            ctx.fillStyle = 'rgba(230, 57, 70, 0.2)';
            ctx.fill();

            requestAnimationFrame(drawChart);
        }
        drawChart();

        // --- MINI GAME LOGIC ---
        function initGame() {
            const grid = document.getElementById('game-grid');
            grid.innerHTML = "";
            for(let i=0; i<16; i++) {
                const cell = document.createElement('div');
                cell.className = 'game-cell';
                cell.id = `cell-${i}`;
                cell.onclick = () => handleGameClick(i);
                grid.appendChild(cell);
            }
        }

        function startGame() {
            gameSequence = [];
            playerSequence = [];
            addLog("GAME STARTED: MEMORIZE PATTERN", "warn");
            nextRound();
        }

        function nextRound() {
            const next = Math.floor(Math.random() * 16);
            gameSequence.push(next);
            playSequence();
        }

        function playSequence() {
            let i = 0;
            const interval = setInterval(() => {
                const id = gameSequence[i];
                const cell = document.getElementById(`cell-${id}`);
                cell.classList.add('active');
                setTimeout(() => cell.classList.remove('active'), 300);
                i++;
                if(i >= gameSequence.length) clearInterval(interval);
            }, 600);
        }

        function handleGameClick(id) {
            const cell = document.getElementById(`cell-${id}`);
            cell.classList.add('success');
            setTimeout(() => cell.classList.remove('success'), 200);
            
            // Simplified logic for demo (just visual feedback)
            addLog(`INPUT RECEIVED: CELL ${id}`, "dim");
        }

        // --- RADAR LOGIC ---
        function initRadar() {
            const screen = document.getElementById('radar-screen');
            setInterval(() => {
                if (Math.random() > 0.7) {
                    const blip = document.createElement('div');
                    blip.className = 'radar-blip';
                    // Random position within circle
                    const angle = Math.random() * Math.PI * 2;
                    const radius = Math.random() * 40; // %
                    const x = 50 + radius * Math.cos(angle);
                    const y = 50 + radius * Math.sin(angle);
                    
                    blip.style.left = x + '%';
                    blip.style.top = y + '%';
                    screen.appendChild(blip);
                    
                    setTimeout(() => blip.remove(), 2000);
                }
            }, 1000);
        }

        // --- DRONE LOGIC ---
        const droneFeeds = {
            'ALPHA': 'https://images.unsplash.com/photo-1473968512647-3e447244af8f?q=80&w=1000',
            'BRAVO': 'https://images.unsplash.com/photo-1504280506541-1763299f5005?q=80&w=1000',
            'CHARLIE': 'https://images.unsplash.com/photo-1518546305927-5a555bb7020d?q=80&w=1000'
        };

        function switchDrone(id) {
            document.querySelectorAll('.drone-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            const img = document.getElementById('drone-feed-img');
            img.style.opacity = 0;
            setTimeout(() => {
                img.src = droneFeeds[id];
                img.style.opacity = 0.8;
                document.getElementById('drone-stats').innerText = `BAT: ${Math.floor(Math.random()*30+60)}% | ALT: ${Math.floor(Math.random()*200+300)}ft | SIG: STRONG`;
                addLog(`DRONE FEED SWITCHED TO ${id}`, "info");
            }, 200);
        }

        function rtbDrone() {
            addLog("COMMAND SENT: RETURN TO BASE", "warn");
        }

        // --- KEYPAD LOGIC ---
        let keyBuffer = "";
        function keyPress(num) {
            if (keyBuffer.length < 4) {
                keyBuffer += num;
                document.getElementById('keypad-display').innerText = keyBuffer.padEnd(4, '-');
            }
        }
        function keyClear() {
            keyBuffer = "";
            document.getElementById('keypad-display').innerText = "----";
        }
        function keyEnter() {
            if (keyBuffer === "1993") {
                addLog("ACCESS GRANTED: LEVEL 5 UNLOCKED", "success");
                showPushNotification("SECURITY", "Clearance Level 5 Authorized", "success");
            } else {
                addLog("ACCESS DENIED: INVALID CODE", "danger");
                keyClear();
            }
        }

        // --- SETTINGS ---
        function openSettings() { document.getElementById('settingsModal').style.display = 'flex'; }
        function closeSettings() { document.getElementById('settingsModal').style.display = 'none'; }
        function toggleSetting(el) { 
            el.classList.toggle('active'); 
            addLog("SETTING UPDATED", "info");
        }

        function initRecentActivity() {
            // Fetch Recent Intel
            db.ref('forum_threads').orderByChild('timestamp').limitToLast(3).on('value', snap => {
                const container = document.getElementById('recent-intel-list');
                container.innerHTML = '';
                let items = [];
                snap.forEach(child => {
                    items.push(child.val());
                });
                items.reverse(); // Show newest first
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'activity-item';
                    const postDate = new Date(item.timestamp).toLocaleDateString();
                    div.innerHTML = `
                        <div class="activity-title">${item.title}</div>
                        <div class="activity-meta">by @${item.author} on ${postDate}</div>
                    `;
                    container.appendChild(div);
                });
            });

            // Fetch Recent Sightings
            db.ref('sightings').orderByChild('timestamp').limitToLast(3).on('value', snap => {
                const container = document.getElementById('recent-sightings-list');
                container.innerHTML = '';
                let items = [];
                snap.forEach(child => {
                    items.push(child.val());
                });
                items.reverse();
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'activity-item';
                    const postDate = new Date(item.timestamp).toLocaleDateString();
                    div.innerHTML = `
                        <div class="activity-title">${item.dinosaur}</div>
                        <div class="activity-meta">at ${item.location} on ${postDate}</div>
                    `;
                    container.appendChild(div);
                });
            });

            // Fetch New Species
            db.ref('dinosaurs').orderByChild('timestamp').limitToLast(3).on('value', snap => {
                const container = document.getElementById('recent-dinosaurs-list');
                container.innerHTML = '';
                let items = [];
                snap.forEach(child => {
                    items.push(child.val());
                });
                items.reverse();
                items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'activity-item';
                    const postDate = new Date(item.timestamp).toLocaleDateString();
                    div.innerHTML = `
                        <div class="activity-title">${item.name}</div>
                        <div class="activity-meta">Classification: ${item.classification}</div>
                    `;
                    container.appendChild(div);
                });
            });
        }

        // --- SIMULATION LOOPS ---
        
        // 1. Integrity Bar Fluctuation
        setInterval(() => {
            const val = (96 + Math.random() * 3.9).toFixed(1);
            const el = document.getElementById('integrity-val');
            const fill = document.getElementById('integrity-fill');
            const uplink = document.getElementById('uplink-fill');
            
            if(el && fill) {
                el.innerText = `${val}%`;
                fill.style.width = `${val}%`;
                uplink.style.width = `${(Math.random() * 20 + 60).toFixed(0)}%`;
                
                if(val < 97) {
                    fill.style.background = 'var(--warning)';
                } else {
                    fill.style.background = 'var(--primary)';
                }
            }
        }, 2000);


        // 3. Random Ambient Logs
        const ambientLogs = [
            "Scanning Sector 7 for thermal anomalies...",
            "Encrypted packet received from unknown source.",
            "Updating local cache...",
            "Ping check: 24ms to Mainframe.",
            "Bio-signature trace complete: Negative.",
            "Refreshing security tokens...",
            "Background task: Data Scrubbing active."
        ];

        setInterval(() => {
            if(Math.random() > 0.7) {
                const msg = ambientLogs[Math.floor(Math.random() * ambientLogs.length)];
                addLog(msg, "dim");
            }
        }, 8000);

        // --- INITIALIZATION ---
        window.onload = () => {
            addLog("Initializing Dark Jurassic OS v4.0...", "info");
            setTimeout(() => addLog("Loading InGen Security Protocols...", "info"), 500);
            setTimeout(() => addLog("Connecting to Firebase Realtime Database...", "info"), 1000);
            setTimeout(() => addLog("System Ready. Waiting for input.", "success"), 1500);
            
            initMap();
            initAudio();
            initTasks();
            initGame();
            initRadar();
            initRecentActivity();
            
            // Simulate a welcome push notification
            setTimeout(() => {
                showPushNotification("WELCOME AGENT", "Secure connection established. Happy hunting.", "success");
            }, 2500);
        };

    </script>
</body>
</html>
