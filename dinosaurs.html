<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Jurassic | Species Database</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary: #e63946;
            --primary-glow: rgba(230, 57, 70, 0.4);
            --bg-dark: #050505;
            --card-bg: #0d0d0d;
            --border: #1a1a1a;
            --accent: #00d4ff;
            --text-main: #f0f0f0;
            --text-dim: #888888;
            --herbivore: #2ecc71;
            --carnivore: #e63946;
            --omnivore: #f1c40f;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }

        body { 
            background-color: var(--bg-dark); 
            color: var(--text-main);
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
        }

        /* Scanline effect */
        body::after {
            content: " ";
            display: block;
            position: fixed;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 9999;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        .top-bar {
            height: 70px;
            background: rgba(10, 10, 10, 0.95);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .back-btn {
            color: var(--text-dim);
            text-decoration: none;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: 0.3s;
        }
        .back-btn:hover { color: var(--primary); }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        .header-section {
            margin-bottom: 40px;
            border-left: 3px solid var(--primary);
            padding-left: 20px;
        }

        .header-section h1 { font-size: 1.5rem; letter-spacing: 2px; text-transform: uppercase; color: var(--primary); }
        .header-section p { color: var(--text-dim); font-size: 0.9rem; margin-top: 5px; }

        /* Upload Panel */
        .upload-panel {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 40px;
        }

        .upload-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .input-field {
            background: #111;
            border: 1px solid var(--border);
            color: white;
            padding: 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            width: 100%;
        }

        .input-field:focus { outline: none; border-color: var(--primary); }

        .btn-upload {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: 0.3s;
            grid-column: 1 / -1;
            margin-top: 10px;
        }

        .btn-upload:hover { box-shadow: 0 0 20px var(--primary-glow); transform: translateY(-2px); }

        /* Species Grid */
        .dino-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
        }

        .dino-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            transition: 0.3s;
            position: relative;
        }

        .dino-card:hover { border-color: var(--primary); transform: translateY(-5px); }

        .dino-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 1px solid var(--border);
        }

        .dino-body { padding: 20px; }
        
        .diet-tag {
            font-size: 0.65rem;
            padding: 3px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: 800;
            display: inline-block;
            margin-bottom: 10px;
        }

        .diet-tag.herbivore { background: rgba(46, 204, 113, 0.2); color: var(--herbivore); }
        .diet-tag.carnivore { background: rgba(230, 57, 70, 0.2); color: var(--carnivore); }
        .diet-tag.omnivore { background: rgba(241, 196, 15, 0.2); color: var(--omnivore); }

        .dino-name { font-size: 1.1rem; color: var(--primary); font-weight: 800; text-transform: uppercase; margin-bottom: 10px; }
        .dino-desc { font-size: 0.85rem; color: var(--text-dim); line-height: 1.5; margin-bottom: 15px; }

        .contributor-tag {
            font-size: 0.7rem;
            color: #444;
            display: flex;
            justify-content: space-between;
            border-top: 1px solid #1a1a1a;
            padding-top: 10px;
            font-family: monospace;
        }

        @media (max-width: 768px) {
            .upload-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body onload="document.body.style.opacity='1'">

    <nav class="top-bar">
        <a href="index.html" class="back-btn"><i class="fa fa-arrow-left"></i> RETURN TO TERMINAL</a>
        <div style="font-size: 0.7rem; color: var(--text-dim); letter-spacing: 2px;">SECURE_DATA_ACCESS</div>
    </nav>

    <div class="container">
        
        <header class="header-section">
            <h1>Intelligence Database</h1>
            <p>Classified biological data on active field specimens.</p>
        </header>

        <!-- Data Entry Section -->
        <section class="upload-panel">
            <h3 style="font-size: 0.8rem; letter-spacing: 1px; color: var(--text-dim);">[+] NEW SPECIES ENTRY</h3>
            <div class="upload-grid">
                <input type="text" id="dino-name" class="input-field" placeholder="Species Designation (e.g. T-Rex)">
                <select id="dino-diet" class="input-field">
                    <option value="Carnivore">Classification: Carnivore</option>
                    <option value="Herbivore">Classification: Herbivore</option>
                    <option value="Omnivore">Classification: Omnivore</option>
                </select>
                <input type="text" id="dino-img" class="input-field" placeholder="Intel Image URL">
                <textarea id="dino-desc" class="input-field" placeholder="Biological Observations / Threat Analysis" style="grid-column: 1 / -1; height: 80px;"></textarea>
                <button class="btn-upload" onclick="uploadDino()"><i class="fa fa-upload"></i> Upload to Central Core</button>
            </div>
        </section>

        <!-- Species List -->
        <div id="dino-list" class="dino-grid">
            <!-- Data populated via JS -->
        </div>

    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBxYUTNlBuhPQ2neLPAYCLDg0e-J76DIuU",
            authDomain: "dark-jurassic-378b5.firebaseapp.com",
            databaseURL: "https://dark-jurassic-378b5-default-rtdb.firebaseio.com/",
            projectId: "dark-jurassic-378b5",
            storageBucket: "dark-jurassic-378b5.firebasestorage.app",
            messagingSenderId: "144100722100",
            appId: "1:144100722100:web:be3b4690724a7a117fdee1"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        auth.onAuthStateChanged((user) => {
            if (user) {
                loadDinos();
            } else {
                window.location.href = "login.html";
            }
        });

        function uploadDino() {
            const name = document.getElementById('dino-name').value;
            const diet = document.getElementById('dino-diet').value;
            const image = document.getElementById('dino-img').value;
            const desc = document.getElementById('dino-desc').value;
            const user = auth.currentUser;

            if (name && diet && image && desc) {
                const username = user.email.split('@')[0].toUpperCase();
                
                db.ref('shared_dinos').push({
                    name: name,
                    diet: diet,
                    image: image,
                    desc: desc,
                    contributor: username,
                    timestamp: Date.now()
                }).then(() => {
                    // Reward XP logic
                    const cleanUsername = user.email.split('@')[0].replace(/\./g, '_');
                    db.ref('users/' + cleanUsername + '/xp').transaction(current => (current || 0) + 100);
                    
                    // Reset fields
                    document.getElementById('dino-name').value = '';
                    document.getElementById('dino-img').value = '';
                    document.getElementById('dino-desc').value = '';
                    
                    showNotification("Data successfully archived. +100 XP granted.");
                });
            } else {
                showNotification("Error: Fields cannot be null.", true);
            }
        }

        function showNotification(msg, isError = false) {
            const n = document.createElement('div');
            n.style.position = 'fixed';
            n.style.bottom = '20px';
            n.style.right = '20px';
            n.style.padding = '15px 25px';
            n.style.background = isError ? 'var(--primary)' : '#1a1a1a';
            n.style.color = 'white';
            n.style.borderRadius = '8px';
            n.style.zIndex = '10000';
            n.style.fontSize = '0.8rem';
            n.style.fontFamily = 'monospace';
            n.style.border = '1px solid var(--border)';
            n.innerText = `[SYSTEM_MSG] ${msg}`;
            document.body.appendChild(n);
            setTimeout(() => n.remove(), 4000);
        }

        function loadDinos() {
            db.ref('shared_dinos').on('value', snap => {
                const list = document.getElementById('dino-list');
                list.innerHTML = "";
                
                let data = [];
                snap.forEach(child => {
                    data.push(child.val());
                });

                // Show newest first
                data.reverse().forEach(d => {
                    const dietClass = d.diet.toLowerCase();
                    list.innerHTML += `
                        <div class="dino-card">
                            <img src="${d.image}" class="dino-img" onerror="this.src='https://via.placeholder.com/400x200?text=IMAGE_NOT_FOUND'">
                            <div class="dino-body">
                                <span class="diet-tag ${dietClass}">${d.diet}</span>
                                <h4 class="dino-name">${d.name}</h4>
                                <p class="dino-desc">${d.desc}</p>
                                <div class="contributor-tag">
                                    <span>SOURCE: ${d.contributor}</span>
                                    <span>ID_${Math.floor(Math.random()*9000)+1000}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
            });
        }
    </script>
</body>
</html>