<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Jurassic | Dino Stones Terminal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --red: #e63946;
            --blue: #00d4ff;
            --gold: #f1c40f;
            --dark-bg: #030303;
            --panel: rgba(15, 15, 15, 0.95);
            --border: rgba(255, 255, 255, 0.08);
            --nav-height: 70px;
        }

        body { 
            background: var(--dark-bg); 
            color: #e0e0e0; 
            margin: 0; 
            font-family: 'Inter', -apple-system, sans-serif; 
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* --- NAVIGATION --- */
        .top-nav {
            height: var(--nav-height);
            background: var(--panel);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-left { display: flex; align-items: center; gap: 20px; }
        .logo-img { height: 40px; filter: drop-shadow(0 0 5px var(--red)); }
        
        .nav-btn {
            color: #888;
            text-decoration: none;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: 0.3s;
            border: 1px solid transparent;
        }

        .nav-btn:hover {
            background: rgba(255,255,255,0.05);
            color: white;
            border-color: var(--border);
        }

        /* --- GAME LAYOUT --- */
        .game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            background: radial-gradient(circle at center, #150505 0%, #030303 100%);
        }

        .status-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .status-header h1 {
            font-size: 0.7rem;
            letter-spacing: 4px;
            color: var(--red);
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        #turn-indicator {
            font-size: 1.5rem;
            font-weight: 900;
            text-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
        }

        /* --- BOARD DESIGN --- */
        .board {
            display: grid;
            grid-template-columns: repeat(3, 110px);
            grid-template-rows: repeat(3, 110px);
            gap: 12px;
            background: rgba(255,255,255,0.02);
            padding: 15px;
            border-radius: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
        }

        .slot {
            background: rgba(255,255,255,0.03);
            border: 1px dashed rgba(255,255,255,0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* --- CARD DESIGN --- */
        .card {
            width: 100px;
            height: 100px;
            border-radius: 12px;
            cursor: pointer;
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
            overflow: hidden;
            border: 2px solid transparent;
        }

        .card.player { 
            background: linear-gradient(135deg, #004e92, #000428); 
            border-color: var(--blue);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
        }

        .card.enemy { 
            background: linear-gradient(135deg, #800000, #200000); 
            border-color: var(--red);
            box-shadow: 0 5px 15px rgba(230, 57, 70, 0.3);
        }

        .card-inner {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 5px;
            box-sizing: border-box;
        }

        .card i { font-size: 1.8rem; margin-bottom: 5px; }
        
        /* Card Stats Positioning */
        .stat {
            position: absolute;
            font-size: 0.75rem;
            font-weight: 800;
            color: white;
            text-shadow: 1px 1px 2px black;
        }
        .stat-t { top: 4px; left: 50%; transform: translateX(-50%); }
        .stat-r { right: 4px; top: 50%; transform: translateY(-50%); }
        .stat-b { bottom: 4px; left: 50%; transform: translateX(-50%); }
        .stat-l { left: 4px; top: 50%; transform: translateY(-50%); }

        /* Hands */
        .hand {
            display: flex;
            gap: 10px;
            margin: 25px 0;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            border: 1px solid var(--border);
        }

        #player-hand .card:hover {
            transform: translateY(-10px) scale(1.05);
            z-index: 10;
        }

        .card.dragging { opacity: 0.5; }

        .controls {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }

        .btn-action {
            background: transparent;
            border: 1px solid var(--red);
            color: var(--red);
            padding: 10px 25px;
            border-radius: 8px;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 2px;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-action:hover {
            background: var(--red);
            color: white;
            box-shadow: 0 0 15px var(--red);
        }

        @media (max-width: 600px) {
            .board { grid-template-columns: repeat(3, 90px); grid-template-rows: repeat(3, 90px); }
            .card { width: 80px; height: 80px; }
            .stat { font-size: 0.6rem; }
        }
    </style>
</head>
<body>

    <nav class="top-nav">
        <div class="nav-left">
            <a href="index.html" class="nav-btn"><i class="fa fa-arrow-left"></i></a>
            <img src="logo.png" alt="Logo" class="logo-img">
        </div>
        <div class="nav-right">
            <span id="player-xp-display" style="color: var(--gold); font-size: 0.8rem; font-weight: bold;"></span>
        </div>
    </nav>

    <div class="game-container">
        <div class="status-header">
            <h1>Tactical Combat Protocol</h1>
            <div id="turn-indicator">INITIALISEREN...</div>
        </div>

        <!-- Enemy Hand -->
        <div class="hand" id="enemy-hand"></div>

        <!-- Combat Board -->
        <div class="board" id="board">
            <div class="slot" data-index="0"></div>
            <div class="slot" data-index="1"></div>
            <div class="slot" data-index="2"></div>
            <div class="slot" data-index="3"></div>
            <div class="slot" data-index="4"></div>
            <div class="slot" data-index="5"></div>
            <div class="slot" data-index="6"></div>
            <div class="slot" data-index="7"></div>
            <div class="slot" data-index="8"></div>
        </div>

        <!-- Player Hand -->
        <div class="hand" id="player-hand"></div>

        <div class="controls">
            <button class="btn-action" onclick="initGame()">Terminal Reset</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBxYUTNlBuhPQ2neLPAYCLDg0e-J76DIuU",
            authDomain: "dark-jurassic-378b5.firebaseapp.com",
            databaseURL: "https://dark-jurassic-378b5-default-rtdb.firebaseio.com/",
            projectId: "dark-jurassic-378b5",
            storageBucket: "dark-jurassic-378b5.firebasestorage.app",
            messagingSenderId: "144100722100",
            appId: "1:144100722100:web:be3b4690724a7a117fdee1"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        let boardState = Array(9).fill(null);
        let isPlayerTurn = true;
        let movesMade = 0;
        let selectedCard = null;

        const DINO_TYPES = [
            { icon: 'fa-dragon', name: 'Rex' },
            { icon: 'fa-hand-back-fist', name: 'Raptor' },
            { icon: 'fa-shield', name: 'Trike' },
            { icon: 'fa-bolt', name: 'Ptero' }
        ];

        auth.onAuthStateChanged(user => {
            if(user) {
                initGame();
                db.ref('users/' + user.email.split('@')[0].replace(/\./g, '_')).on('value', s => {
                    document.getElementById('player-xp-display').innerText = (s.val()?.xp || 0) + " XP";
                });
            } else {
                window.location.href = "login.html";
            }
        });

        function createCard(owner) {
            const type = DINO_TYPES[Math.floor(Math.random() * DINO_TYPES.length)];
            const stats = {
                t: Math.floor(Math.random() * 8) + 1,
                r: Math.floor(Math.random() * 8) + 1,
                b: Math.floor(Math.random() * 8) + 1,
                l: Math.floor(Math.random() * 8) + 1
            };
            
            const card = document.createElement('div');
            card.className = `card ${owner}`;
            card.dataset.stats = JSON.stringify(stats);
            card.dataset.owner = owner;
            
            card.innerHTML = `
                <div class="card-inner">
                    <i class="fa ${type.icon}"></i>
                    <div class="stat stat-t">${stats.t}</div>
                    <div class="stat stat-r">${stats.r}</div>
                    <div class="stat stat-b">${stats.b}</div>
                    <div class="stat stat-l">${stats.l}</div>
                </div>
            `;

            if(owner === 'player') {
                card.onclick = () => {
                    if(!isPlayerTurn) return;
                    document.querySelectorAll('#player-hand .card').forEach(c => c.style.borderColor = 'transparent');
                    card.style.borderColor = 'var(--blue)';
                    selectedCard = card;
                };
            }

            return card;
        }

        function initGame() {
            boardState = Array(9).fill(null);
            movesMade = 0;
            isPlayerTurn = true;
            document.getElementById('player-hand').innerHTML = "";
            document.getElementById('enemy-hand').innerHTML = "";
            document.querySelectorAll('.slot').forEach(s => s.innerHTML = "");

            for(let i=0; i<5; i++) {
                document.getElementById('player-hand').appendChild(createCard('player'));
                document.getElementById('enemy-hand').appendChild(createCard('enemy'));
            }

            document.querySelectorAll('.slot').forEach(slot => {
                slot.onclick = () => {
                    const idx = slot.dataset.index;
                    if(isPlayerTurn && selectedCard && !boardState[idx]) {
                        placeCard(idx, selectedCard, 'player');
                        selectedCard = null;
                        isPlayerTurn = false;
                        updateTurnStatus();
                        setTimeout(enemyAI, 1000);
                    }
                };
            });

            updateTurnStatus();
        }

        function placeCard(idx, cardEl, owner) {
            const slot = document.querySelectorAll('.slot')[idx];
            slot.appendChild(cardEl);
            boardState[idx] = { 
                owner: owner, 
                stats: JSON.parse(cardEl.dataset.stats) 
            };
            battle(idx);
            movesMade++;
            checkGameOver();
        }

        function battle(idx) {
            idx = parseInt(idx);
            const cur = boardState[idx];
            const targets = [
                { p: idx - 3, s: 't', os: 'b' }, // Top
                { p: idx + 3, s: 'b', os: 't' }, // Bottom
                { p: idx - 1, s: 'l', os: 'r', r: true }, // Left
                { p: idx + 1, s: 'r', os: 'l', r: true }  // Right
            ];

            targets.forEach(t => {
                if(t.p >= 0 && t.p < 9 && boardState[t.p]) {
                    if(t.r && Math.floor(t.p/3) !== Math.floor(idx/3)) return; // Rij check
                    const other = boardState[t.p];
                    if(other.owner !== cur.owner && cur.stats[t.s] > other.stats[t.os]) {
                        other.owner = cur.owner;
                        const otherCard = document.querySelectorAll('.slot')[t.p].querySelector('.card');
                        otherCard.className = `card ${cur.owner}`;
                    }
                }
            });
        }

        function enemyAI() {
            if (movesMade >= 9) return;
            const empty = boardState.map((s, i) => s === null ? i : null).filter(s => s !== null);
            const eCards = document.querySelectorAll('#enemy-hand .card');
            
            if(empty.length > 0 && eCards.length > 0) {
                const randomSlot = empty[Math.floor(Math.random() * empty.length)];
                placeCard(randomSlot, eCards[0], 'enemy');
            }
            
            isPlayerTurn = true;
            updateTurnStatus();
        }

        function updateTurnStatus() {
            const i = document.getElementById('turn-indicator');
            i.innerText = isPlayerTurn ? "JOUW BEURT" : "INGEN ANALYSE...";
            i.style.color = isPlayerTurn ? "var(--blue)" : "var(--red)";
        }

        function checkGameOver() {
            if (movesMade === 9) {
                let pCount = 0;
                boardState.forEach(s => { if(s.owner === 'player') pCount++; });
                
                const win = pCount > 4;
                const i = document.getElementById('turn-indicator');
                i.innerText = win ? `OVERWINNING (${pCount}-4)` : `NEDERLAAG (${pCount}-5)`;
                i.style.color = win ? "var(--gold)" : "var(--red)";

                if(win) {
                    const username = auth.currentUser.email.split('@')[0].replace(/\./g, '_');
                    db.ref('users/' + username + '/xp').transaction(current => (current || 0) + 25);
                }
            }
        }
    </script>
</body>
</html>